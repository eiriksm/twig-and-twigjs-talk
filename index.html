<html>
    <head>
        <link rel="stylesheet" href="assets/css/reveal.css">
        <link rel="stylesheet" href="assets/css/theme/moon.css">
        <link rel="stylesheet" href="assets/css/style.css">
        <title>Explorations in re-using Twig templates for the front-end</title>
    </head>
    <body>
        <div class="link"><a class="tw" href="https://twitter.com/orkj">@orkj: Twig.js talk</a></div>
        <div class="reveal">
            <div class="slides">
                <section>
                    <div data-markdown>
                  ## Explorations in re-using Twig templates for the front-end

                  - Eirik Morland
                  - Developer at Ny Media
                  - eiriksm@gh / eiriksm@d.o / @orkj
                  </div>
                  <aside class="notes">
                      The backstory for this talk was this animated gif I posted about 3 years ago. I just checked it out, and it was in January 2015, and the Drupal version in question was Drupal 8, beta 4
                     </aside>
                </section>
                <section>
                  <img src="assets/img/vztBlal.gif" class="stretch" />
                </section>
                <section>
                    <div data-markdown>
                  ## What we will cover

                  - What is the story behind getting where we are now?
                  - What is the current state of how we can do this?
                  - What are some usecases for implementing it?
                  - What are some bad examples of template-sharing code-bases?
                  - Hacks, tips and tricks
                  </div>
                  <aside class="notes">
                      To get to the bottom of this, I will tell you a magical tale about 2 families.
                  </aside>
                </section>
                <section data-markdown>
                    <div data-markdown>
                  ## What we will cover

                  - Art
                  - Magic
                  - Heroes
                  - Villains
                  - Dark sorcery
                </div>
                  <aside class="notes"It will be a tale of art, magic, heroes, villains and dark sorcery.></aside>
                </section>
                <section data-background="assets/img/bbang.gif">
                  <div data-markdown>
                    ## 1. In the beginning...
                  </div>
                  <aside class="notes">
                    In the beginning these two tribes were very different. Some may even say they lived in different villages. Or maybe continents. What the heck, they were even...
                  </aside>
                </section>
                <section data-markdown data-background="assets/img/worlds-apart-o.gif">
                  ## ...worlds apart
                </section>
                <section>
                  <pre><code data-trim data-noescape>
                    &lt;marquee>
                      &lt;blink>&lt;?php print $page_title; ?>&lt;/blink>
                    &lt;/marquee>
                  </code></pre>
                  <aside class="notes">
                    PHP was a tribe where their traditional art was mostly concerned about dynamically printing the text to go inside a &lt;marquee> tag.
                  </aside>
                </section>
                <section>
                  <img class="stretch" src="assets/img/07fig01.gif" />
                  <aside class="notes">
                    JavaScript was a tribe with artwork mostly about getting scrolling text inside of the browser status bar. So in some ways they were already similar. Both concerned about making scrolling text.
                  </aside>
                </section>
                <section>
                  <img class="stretch" src="assets/img/moments.png" />
                  <aside class="notes">
                    And then you had a couple of magic moments where the tribes were collaborating on real pieces of art, about making the web a better place. But this was ages ago in the web world.
                  </aside>
                </section>
                <section data-background="assets/img/cat-creen.gif">
                  <aside class="notes">
                    Fast forward some years, and the collaboration between the tribes thriving. Byte after byte of PHP processed data went all the way to the JavaScript running in peoples browsers, making the experiences both interactive and flexible.
                  </aside>
                </section>
                <section data-background="assets/img/reversed.gif">
                  <aside class="notes">
                    In many ways, the roles were reversed. JavaScript had the honor of creating HTML, while PHP had started sending things for the JavaScript from the server.
                  </aside>
                </section>
                <section>
                  <img class="stretch" src="assets/img/twig-logo.jpg" />
                  <aside class="notes">
                    And with time we got twig in Drupal core, which is not php any more, and so much nicer to use.
                  </aside>
                </section>
                <section>
                  <img class="stretch" src="assets/img/soup.png" />
                  <aside class="notes">
                    But still, I assume many client/server relationships looks like this: (twig and jq soup). Or this
                  </aside>
                </section>
                <section>
                  <h2>page.html.twig</h2>
                  <pre><code>
                    &lt;h2>{{ title }}&lt;/h2>
                    &lt;div id="app">&lt;/div>
                  </code></pre>
                  <h2>app.js</h2>
                  <code><pre>
                    React.render(
                      &lt;App />,
                      document.getElementById('app')
                    );
                  </code></pre>
                  <aside class="notes">
                    So. The tribes had a healthy exchange of culture, which is good. But still the PHP tribe would only draw in a certain way, and JavaScript would still need to interpret it with their cultural heritage.
                  </aside>
                </section>
                <section>
                  <img src="assets/img/magritte1.jpg" class="stretch" />
                  <aside class="notes">
                    Maybe it can be examplified with something like this? Maybe PHP painted this, and JavaScript wrote this, and it's all actually very cool. (pic of not a pipe)
                  </aside>
                </section>
                <section>
                  <img src="assets/img/magritte2.jpg" class="stretch" />
                  <aside class="notes">
                    Or maybe like this? (pic of magritte painting an egg). So with that out of the way, let us look at the current state of using Twig on the back-end.
                  </aside>
                </section>
                <section data-markdown>
                  ## 2. Current state of things
                </section>
                <section>
                  <div data-markdown>
                  ### Twig.js

                  >...a pure JavaScript implementation of the Twig PHP templating language
                  </div>
                  <aside class="notes">
                    There is a project called Twig.js, which is esentially
>...a pure JavaScript implementation of the Twig PHP templating language.

Which one would think would mean that a person could now just start using twig in the browser, right? Or maybe not? So let's just dive right into it.
                  </aside>
                </section>
                <section>
                  <img src="assets/img/ctrl.png" class="stretch" />
                </section>
                <section>
                  <img src="assets/img/ctrl_js.png" class="stretch" />
                </section>
                <section>
                  <img src="assets/img/secs.gif" class="stretch" />
                  <aside class="notes">
                    So, The state of things is, we can use twig templates in the browser now. Or to get back to the metaphor. Both tribes are somewhat using the same type of paint, and painting similar motives, and are now forming bonds across tribes.
                  </aside>
                </section>
                <section data-markdown>
                  ## 3. Use-cases for implementing it.

                  - Optimistic rendering
                  - Simple client side applications that updates lists
                </section>
                <section>
                  <img src="assets/img/update.gif" alt="" class="stretch">
                  <aside class="notes">
                    A place where this approach really can shine, is where you want to post comments or messages, and are optimistically rendering the result of that posting, before the server has responded. Here is one example of that, where we can see that the optimistic rendering is using the same node display template as the server, but displays it (at least partially) before it gets rendered on the server.
                  </aside>
                </section>
                <section>
                  <img src="assets/img/ctrl2.png" alt="" class="stretch">
                  <aside class="notes">
                    Another place I think it shines is very simple client side applications, where for example a list is supposed to be updated from time to time. Like "users online". You can render the initial state of the users, and then as it updates, you can use the same template to render the new list of users.
                  </aside>
                </section>
                <section>
                  <img src="assets/img/ctrl_js2.png" alt="" class="stretch">
                </section>
                <section>
                  <img src="assets/img/users.gif" alt="" class="stretch">
                  <aside class="notes">
                    So is this the end of the tale? Are the tribes living together, creating art in beautiful harmony? Well, not really. Things are a bit more complex than my two small rainbow examples.
                  </aside>
                </section>
                <section data-background="assets/img/bidea.gif">
                  <div data-markdown>
                    ## 4 Bad examples
                  </div>
                  <aside class="notes">
                    If we are returning to the metaphor, this is probably the place where the two tribes were excited about the fact that they can collaborate in creating art history. But the differences in either their dialect, culture or just pronunciation made it so that not all pictures were agreed upon. Things got lost in translation. Or were untranslatable. Let's have a look at this.
                  </aside>
                </section>
                <section>
                  <img class="stretch" src="assets/img/bartik.png" />
                  <aside class="notes">
                    One really simple example of this is literally about translation. In Drupal templates we use a tag called the `{% trans %}` tag, that we use for translation. In vanilla twig.js this simply does not exist. So if we tried to re-use a template that used this tag, it would totally crash in the browser.
                  </aside>
                </section>
                <section>
                  <img class="stretch" src="assets/img/trans.png" />
                </section>
                <section>
                  <img src="assets/img/extend.png" class="stretch" />
                  <aside class="notes">
                    In a problem solving matter, one can actually extend twig.js to add this trans tag. So to continue the metaphor, the JavaScript tribe was maybe missing a type of brush to mimic the PHP painting. But there are other issues.
                  </aside>
                </section>
                <section>
                  <img class="stretch" src="assets/img/bartik.png" />
                  <aside class="notes">
                    Let's look at the default node template in bartik.
                    There are several things here, but let's take a look at the magic variable `{{ content }}`.
                    Drupal is a flexible system, and to represent this in a template, this variable actually contains all the potential fields a node can have. Images, categories and rich text. To make this possible, Drupal renders all of the contents of content, so to speak.

                  </aside>
                </section>
                <section>
                  <img src="assets/img/nodephp.png" class="stretch" />
                  <aside class="notes">
                    This is convenient. But very inconvenient if you try to re-use that template for a structure that is similar. [pic of something like that]
                  </aside>
                </section>
                <section>
                  <img src="assets/img/nodejs.png" class="stretch" />
                </section>
                <section>
                  <div data-markdown>
                    ## Cost/value

                    - Twig.js minified is 83K
                    - React.js + React DOM minified is 46kb
                  </div>
                  <aside class="notes">
                    Now the third point I would like to make in this context, is the cost of adding a template language like twig to you client side bundle. Minified, twigjs clocks in at 83KB [CHECK IT], which is like way more than for example React.

                    So, say you wanted to include it to do specifically only the users online part, which was examplified earlier. It would be a pretty high cost to include the library only for that. Could there be another way?
                  </aside>
                </section>
                <section>
                  <div data-markdown>
                    ## 5. Hacks
                  </div>
                  <aside class="notes">
                    In Drupal 8, we already have a client side library with a template language. No, I am not talking about this language.
                  </aside>
                </section>
                <section>
                  <img src="assets/img/jq-soup.png" class="stretch" />
                  <aside class="notes">
                    I am talking about underscore.js
                  </aside>
                </section>
                <section>
                  <div data-markdown>
                  ## underscore.js
                  </div>
                  <aside class="notes">
                    Underscore has a template function. It looks something like this:
                  </aside>
                </section>
                <section>
                  <div data-markdown>
                  ```js
var compiled = _.template("hello: <%= name %>");
compiled({name: 'moe'});
=> "hello: moe"
```
</div>
<aside class="notes">
  So what does this have to do with twig? Or to return to our metaphor... Is this JavaScript trying to write "this is not a pipe" all over again?
</aside>
                </section>
                <section>
                  <div data-markdown>
                    ```
var templateSettings = {
  interpolate: /\{\{(.+?)\}\}/g
};
```
                  </div>
                  <aside class="notes">
                    OK, that was probably a bit abstract, but that enabled us to make templates like this. Does this look familiar?
                  </aside>
                </section>
                <section>
                  <div data-markdown>
                    ```
var compiled = _.template("hello: {{ name }}", templateSettings);
compiled({name: 'moe'});
=> "hello: moe"
```
                  </div>
                  <aside class="notes">
                    So basically if you have small pieces of your application that needs to be rendered both client side and server side, and those pieces are not nested render arrays, you already have everything you need to be able to achieve this. Of course this a a whole range of limitations. One of them is that the underscore template language does not give you twig for loops, but getting around this would be an excecise for the audience.
                  </aside>
                </section>
                <section>
                  <div data-markdown>
## Summary

- It is possible to use twig on both the client and the server
- Sharing templates can be quite a bliss.
- Complex templates can be hard to share.
- For small tasks you can actually use underscore.js which is in core.
                  </div>
                </section>
                <section>
                  <div data-markdown>
                    ## Resources

- [Twig website](https://twig.symfony.com/)
- [Twig.js website](https://github.com/twigjs/twig.js)
- [Twig.js module for Drupal 8.](https://www.drupal.org/project/twigjs)
- [https://eiriksm.github.io/twig-and-twigjs-talk/ (slides)](https://eiriksm.github.io/twig-and-twigjs-talk/)
                  </div>
                </section>
            </div>
        </div>
        <script src="assets/lib/js/head.min.js"></script>
        <script src="assets/js/reveal.js"></script>
        <script>
            Reveal.initialize({
              history: true,
              dependencies: [
                { src: 'assets/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                { src: 'assets/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'assets/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: 'assets/plugin/notes/notes.js', async: true }
              ]
            });
        </script>
    </body>
</html>
